{"ast":null,"code":"export default {\n  name: 'Cart',\n  props: ['showSnack'],\n\n  data() {\n    return {\n      dialog: false,\n      valid: true,\n      snackbar: false,\n      user: {\n        firstName: '',\n        secondName: '',\n        phone: '',\n        email: '',\n        comment: '',\n        promo: ''\n      },\n      nameRules: [v => !!v || 'Заполните поле', v => v && v.length > 2 || 'Field must be less than 2 characters'],\n      emailRules: [v => !!v || 'Введите адрес', v => /.+@.+\\..+/.test(v) || 'Неверный адрес'],\n      phoneRules: [v => !!v || 'Введите номер', v => v && v.length === 9 || 'Неверный номер']\n    };\n  },\n\n  computed: {\n    items() {\n      return this.$store.getters.getCart;\n    },\n\n    totalPrice() {\n      return this.items.reduce((sum, item) => item.quantity * item.product.price + sum, 0);\n    },\n\n    promotion() {\n      if (this.user.promo === '1111') {\n        return 500;\n      }\n\n      return 0;\n    }\n\n  },\n  methods: {\n    validate() {\n      this.$refs.form.validate();\n    },\n\n    reset() {\n      this.$refs.form.reset();\n    },\n\n    checkout() {\n      this.validate();\n      this.$nextTick(() => {\n        if (this.valid) {\n          this.saveToLocalstorage();\n          this.clearCart();\n          this.reset();\n          this.showSnack();\n          this.dialog = false;\n        }\n      });\n    },\n\n    deleteItem(index) {\n      this.$store.dispatch('deleteProduct', index);\n    },\n\n    saveToLocalstorage() {\n      const orders = JSON.parse(localStorage.getItem('orders')) || [];\n      const order = {\n        items: this.items,\n        price: this.totalPrice,\n        pay: this.totalPrice - this.promotion,\n        user: Object.assign({}, this.user),\n        date: new Date().toISOString().split('T')[0]\n      };\n      orders.push(order);\n      this.$store.dispatch('setOrder', order);\n      localStorage.setItem('orders', JSON.stringify(orders));\n    },\n\n    clearCart() {\n      this.$store.dispatch('clearCart');\n    }\n\n  }\n};","map":{"version":3,"mappings":"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","names":["name","props","data","dialog","valid","snackbar","user","firstName","secondName","phone","email","comment","promo","nameRules","v","length","emailRules","test","phoneRules","computed","items","$store","getters","getCart","totalPrice","reduce","sum","item","quantity","product","price","promotion","methods","validate","$refs","form","reset","checkout","$nextTick","saveToLocalstorage","clearCart","showSnack","deleteItem","index","dispatch","orders","JSON","parse","localStorage","getItem","order","pay","Object","assign","date","Date","toISOString","split","push","setItem","stringify"],"sourceRoot":"","sources":["C:\\Users\\Mvideo\\Desktop\\pcconf\\frontend\\src\\components\\Cart.vue"],"sourcesContent":["<script>\nexport default {\n  name: 'Cart',\n  props: ['showSnack'],\n  data () {\n    return {\n      dialog: false,\n      valid: true,\n      snackbar: false,\n      user: {\n        firstName: '',\n        secondName: '',\n        phone: '',\n        email: '',\n        comment: '',\n        promo: ''\n      },\n      nameRules: [\n        v => !!v || 'Заполните поле',\n        v => (v && v.length > 2) || 'Field must be less than 2 characters'\n      ],\n      emailRules: [\n        v => !!v || 'Введите адрес',\n        v => /.+@.+\\..+/.test(v) || 'Неверный адрес'\n      ],\n      phoneRules: [\n        v => !!v || 'Введите номер',\n        v => (v && v.length === 9) || 'Неверный номер'\n      ]\n    }\n  },\n  computed: {\n    items () {\n      return this.$store.getters.getCart\n    },\n    totalPrice () {\n      return this.items.reduce((sum, item) => (item.quantity * item.product.price) + sum, 0)\n    },\n    promotion () {\n      if (this.user.promo === '1111') {\n        return 500\n      }\n      return 0\n    }\n  },\n  methods: {\n    validate () {\n      this.$refs.form.validate()\n    },\n    reset () {\n      this.$refs.form.reset()\n    },\n    checkout () {\n      this.validate()\n      this.$nextTick(() => {\n        if (this.valid) {\n          this.saveToLocalstorage()\n          this.clearCart()\n          this.reset()\n          this.showSnack()\n          this.dialog = false\n        }\n      })\n    },\n    deleteItem (index) {\n      this.$store.dispatch('deleteProduct', index)\n    },\n    saveToLocalstorage () {\n      const orders = JSON.parse(localStorage.getItem('orders')) || []\n\n      const order = {\n        items: this.items,\n        price: this.totalPrice,\n        pay: this.totalPrice - this.promotion,\n        user: Object.assign({}, this.user),\n        date: new Date().toISOString().split('T')[0]\n      }\n\n      orders.push(order)\n\n      this.$store.dispatch('setOrder', order)\n\n      localStorage.setItem('orders', JSON.stringify(orders))\n    },\n    clearCart () {\n      this.$store.dispatch('clearCart')\n    }\n  }\n}\n</script>\n\n<template>\n<div>\n  <v-menu\n    left\n    bottom\n    :close-on-content-click=\"false\"\n    offset-y\n  >\n    <template v-slot:activator=\"{ on }\">\n      <v-btn icon v-on=\"on\">\n        <v-badge\n          color=\"red\"\n          :content=\"items.length\"\n          :value=\"items.length\"\n          overlap\n        >\n          <v-icon large>mdi-cart</v-icon>\n        </v-badge>\n      </v-btn>\n    </template>\n    <v-card v-if=\"items.length\">\n      <v-list subheader>\n        <v-subheader>Корзина</v-subheader>\n\n        <v-list-item\n          v-for=\"(item, index) in items\"\n          :key=\"index\"\n          @click=\"()=>{}\"\n        >\n          <v-list-item-avatar>\n            <v-img\n              :src=\"require('../' + item.product.image)\"\n              :contain=\"true\"\n            ></v-img>\n          </v-list-item-avatar>\n\n          <v-list-item-content>\n            <v-list-item-title v-text=\"item.product.name\"></v-list-item-title>\n          </v-list-item-content>\n\n          <v-list-item-action class=\"ml-7\">\n            <div class=\"cart-price\">\n              <div class=\"text-input\">\n                <v-text-field v-model=\"item.quantity\" hide-details type=\"number\"></v-text-field>\n              </div>\n              <div> x {{item.product.price}} $</div>\n              <div>\n                <v-btn class=\"ml-3\" icon @click=\"deleteItem(index)\">\n                  <v-icon>mdi-close-circle</v-icon>\n                </v-btn>\n              </div>\n            </div>\n          </v-list-item-action>\n        </v-list-item>\n      </v-list>\n      <v-divider></v-divider>\n      <v-card-text class=\"d-flex\">\n        <span class=\"subtitle-1 font-regular mt-1\"> Итого: {{totalPrice}} $</span>\n        <v-spacer></v-spacer>\n        <v-btn color=\"#d76e00\" class=\"text-capitalize\" @click=\"dialog = true\" dark>Купить</v-btn>\n      </v-card-text>\n    </v-card>\n    <v-card v-else>\n      <v-card-text>\n        Корзина пуста!\n      </v-card-text>\n    </v-card>\n  </v-menu>\n  <v-dialog v-model=\"dialog\" persistent max-width=\"600px\">\n    <v-card>\n      <v-card-title>\n        <span class=\"headline\">Оформление заказа</span>\n      </v-card-title>\n      <v-card-text>\n        <v-container>\n          <v-form\n            ref=\"form\"\n            v-model=\"valid\"\n          >\n          <v-row>\n            <v-col cols=\"6\" class=\"pa-1\">\n              <v-text-field label=\"Имя*\" :rules=\"nameRules\" v-model=\"user.firstName\" required></v-text-field>\n            </v-col>\n            <v-col cols=\"6\" class=\"pa-1\">\n              <v-text-field label=\"Фамилия*\" :rules=\"nameRules\" v-model=\"user.secondName\" required></v-text-field>\n            </v-col>\n            <v-col cols=\"6\" class=\"pa-1\">\n              <v-text-field\n                label=\"Телефон*\"\n                persistent-hint\n                :rules=\"phoneRules\"\n                required\n                v-model=\"user.phone\"\n              ></v-text-field>\n            </v-col>\n            <v-col cols=\"6\" class=\"pa-1\">\n              <v-text-field label=\"E-mail*\" :rules=\"emailRules\" v-model=\"user.email\" required></v-text-field>\n            </v-col>\n            <v-col cols=\"12\" class=\"pa-1\">\n              <v-textarea label=\"Комментарий\" v-model=\"user.comment\"></v-textarea>\n            </v-col>\n            <v-col cols=\"12\" class=\"pa-1\">\n              <v-text-field label=\"Промокод\" v-model=\"user.promo\"></v-text-field>\n            </v-col>\n          </v-row>\n          </v-form>\n        </v-container>\n\n        <v-row>\n          <v-col cols=\"12\" class=\"subtitle-1 py-0 text-right font-weight-black\">Итого: {{totalPrice}} $</v-col>\n          <v-col cols=\"12\" class=\"subtitle-1 py-0 text-right font-weight-black\">Скидка: {{promotion}} $</v-col>\n          <v-col cols=\"12\" class=\"subtitle-1 py-0 text-right font-weight-black\">К оплате: {{totalPrice - promotion}} $</v-col>\n        </v-row>\n      </v-card-text>\n      <v-card-actions>\n        <small class=\"caption ml-3\">*обязательное поле</small>\n        <v-spacer></v-spacer>\n        <v-btn color=\"#d76e00\" text @click=\"dialog = false\">Закрыть</v-btn>\n        <v-btn color=\"#d76e00\" text @click=\"checkout()\">Оплатить</v-btn>\n      </v-card-actions>\n    </v-card>\n  </v-dialog>\n</div>\n</template>\n\n<style scoped>\n  .text-input {\n    width: 40px;\n  }\n\n  .cart-price {\n    display: grid;\n    grid-template-columns: 1fr 1fr 1fr;\n  }\n\n  .cart-price > div {\n    align-self: center;\n  }\n\n  .cart-price > div:last-child {\n    justify-self: end;\n  }\n</style>\n"]},"metadata":{},"sourceType":"module"}